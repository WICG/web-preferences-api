<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Web Preferences API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-UD" rel="stylesheet">
  <meta content="Bikeshed version 5edf5e459, updated Thu Jun 22 11:28:01 2023 -0700" name="generator">
  <link href="https://specs.lukewarlow.dev/web-preferences-api/" rel="canonical">
  <meta content="4b1c34ad58eee2523dd47fe76f8baa9175e58bf7" name="document-revision">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Web Preferences API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#UD">Unofficial Proposal Draft</a>, <time class="dt-updated" datetime="2023-09-05">5 September 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://specs.lukewarlow.dev/web-preferences-api/">https://specs.lukewarlow.dev/web-preferences-api/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/lukewarlow/web-preferences-api/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:luke@warlow.dev">Luke Warlow</a> (<span class="p-org org">unaffiliated</span>)
     <dt>Tests:
     <dd><a href="https://github.com/w3c/web-platform-tests/tree/master/web-preferences-api">web-platform-tests web-preferences-api/</a> (<a href="https://github.com/w3c/web-platform-tests/labels/web-preferences-api">not started</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to the Web Preferences API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Web Preference API aims to provide a way for sites to override the value for a given user preference (e.g. color-scheme preference) in a way that fully integrates with existing Web APIs.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#sec-intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#extensions-to-the-navigator-interface"><span class="secno">2</span> <span class="content">Extensions to the <code class="idl"><span>Navigator</span></code> interface</span></a>
     <ol class="toc">
      <li><a href="#preferences-attribute"><span class="secno">2.1</span> <span class="content"><code class="idl"><span>preferences</span></code> attribute</span></a>
     </ol>
    <li>
     <a href="#preference-manager"><span class="secno">3</span> <span class="content"><code class="idl"><span>PreferenceManager</span></code> interface</span></a>
     <ol class="toc">
      <li>
       <a href="#get-supported-method"><span class="secno">3.1</span> <span class="content"><code class="idl"><span>getSupported</span></code> method</span></a>
       <ol class="toc">
        <li><a href="#preferencesupportdata-interface"><span class="secno">3.1.1</span> <span class="content"><code class="idl"><span>PreferenceSupportData</span></code> interface</span></a>
       </ol>
      <li>
       <a href="#preference-attributes"><span class="secno">3.2</span> <span class="content">Preference attributes</span></a>
       <ol class="toc">
        <li><a href="#setting-a-preference-attribute"><span class="secno">3.2.1</span> <span class="content">Setting a preference attribute</span></a>
        <li><a href="#getting-a-preference-attribute"><span class="secno">3.2.2</span> <span class="content">Getting a preference attribute</span></a>
        <li><a href="#colorscheme-preference"><span class="secno">3.2.3</span> <span class="content"><code class="idl"><span>colorScheme</span></code> preference</span></a>
        <li><a href="#contrast-preference"><span class="secno">3.2.4</span> <span class="content"><code class="idl"><span>contrast</span></code> preference</span></a>
        <li><a href="#reducedmotion-preference"><span class="secno">3.2.5</span> <span class="content"><code class="idl"><span>reducedMotion</span></code> preference</span></a>
        <li><a href="#reducedtransparency-preference"><span class="secno">3.2.6</span> <span class="content"><code class="idl"><span>reducedTransparency</span></code> preference</span></a>
        <li><a href="#reduceddata-preference"><span class="secno">3.2.7</span> <span class="content"><code class="idl"><span>reducedData</span></code> preference</span></a>
       </ol>
     </ol>
    <li>
     <a href="#usage-examples"><span class="secno">4</span> <span class="content">Usage Examples</span></a>
     <ol class="toc">
      <li><a href="#setting-a-preference-override"><span class="secno">4.1</span> <span class="content">Setting a preference override</span></a>
      <li><a href="#clearing-overrides"><span class="secno">4.2</span> <span class="content">Clearing a preference override</span></a>
      <li><a href="#getting-a-preference-override"><span class="secno">4.3</span> <span class="content">Getting a preference override</span></a>
      <li><a href="#get-supported"><span class="secno">4.4</span> <span class="content">The <code>navigator.preferences.getSupported</code> method</span></a>
     </ol>
    <li>
     <a href="#sec-security"><span class="secno">5</span> <span class="content">Security and Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#fingerprinting"><span class="secno">5.1</span> <span class="content">Avoiding fingerprinting</span></a>
      <li><a href="#permissions"><span class="secno">5.2</span> <span class="content">Permissions &amp; User Activation</span></a>
      <li><a href="#sub-resources"><span class="secno">5.3</span> <span class="content">Sub-resources</span></a>
     </ol>
    <li><a href="#sec-acknowledgements"><span class="secno">6</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <p class="issue" id="issue-04eeaa1b"><a class="self-link" href="#issue-04eeaa1b"></a> This spec requires large amounts of work to section it and word it in ways that are normative. It is currently a very rough draft.</p>
   <h2 class="heading settled" data-level="1" id="sec-intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#sec-intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>Currently, website authors have a choice when wishing to honour a user’s preference for a given setting:</p>
   <p>They can choose to "use the platform" where the user must indicate their preference via their OS or, if lucky, they can override in the browser. This comes with a number of issues:</p>
   <ul>
    <li data-md>
     <p>Relies on the user’s OS or browser offering the ability to change the setting</p>
    <li data-md>
     <p>Relies on the user knowing how to change the setting in their OS or browser</p>
    <li data-md>
     <p>No ability to override the setting for a specific site</p>
    <li data-md>
     <p>No ability to sync preferences for a site across devices</p>
   </ul>
   <p>Alternatively, sites can and do offer site-level settings, but this currently comes with a number of issues:</p>
   <ul>
    <li data-md>
     <p>No integration with <a href="https://drafts.csswg.org/mediaqueries-5/#mf-user-preferences"><cite>Media Queries 5</cite> §  11. User Preference Media Features</a></p>
    <li data-md>
     <p>No integration with conditional resource loading (e.g. using <code>&lt;source media="(prefers-contrast: more)"></code>)</p>
    <li data-md>
     <p>No integration with JS APIs for retrieval of these preferences (e.g. <code>matchMedia</code> in <a href="https://drafts.csswg.org/cssom-view-1/#extensions-to-the-window-interface"><cite>CSSOM View</cite> § 4 Extensions to the Window Interface</a></p>
    <li data-md>
     <p>No integration with <a data-link-type="biblio" href="#biblio-user-preference-media-features-headers" title="User Preference Media Features Client Hints Headers">[USER-PREFERENCE-MEDIA-FEATURES-HEADERS]</a></p>
    <li data-md>
     <p>No integration with the <a href="https://drafts.csswg.org/css-color-adjust-1/#preferred"><cite>CSS Color Adjustment 1</cite> § 2 Preferred Color Schemes</a> concept</p>
    <li data-md>
     <p>The various client storage mechanisms that could store these preferences can be cleared in a number of scenarios</p>
   </ul>
   <p class="issue" id="issue-1b6e079b">
    <a class="self-link" href="#issue-1b6e079b"></a> Unsure how to link to html spec for the 
    <source media>
     example.
   </p>
   <p>The <strong>Web Preferences API</strong> aims to solve this by providing a way for sites to override the value for a given a user preference.</p>
   <p>It is intended for this override to apply permanently and be scoped per origin.
The override should be passed down to sub-resource where possible, see privacy section for details. This explainer refers to "site" but it should be read to mean <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a>.</p>
   <h2 class="heading settled" data-level="2" id="extensions-to-the-navigator-interface"><span class="secno">2. </span><span class="content">Extensions to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator">Navigator</a></code> interface</span><a class="self-link" href="#extensions-to-the-navigator-interface"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator" id="ref-for-navigator①"><c- g>Navigator</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#preferencemanager" id="ref-for-preferencemanager"><c- n>PreferenceManager</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="Navigator" data-dfn-type="attribute" data-export data-readonly data-type="PreferenceManager" id="dom-navigator-preferences"><code><c- g>preferences</c-></code></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="2.1" id="preferences-attribute"><span class="secno">2.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-navigator-preferences" id="ref-for-dom-navigator-preferences">preferences</a></code> attribute</span><a class="self-link" href="#preferences-attribute"></a></h3>
   <p>When getting the <code class="idl"><a data-link-type="idl" href="#dom-navigator-preferences" id="ref-for-dom-navigator-preferences①">preferences</a></code> attribute always return the same instance of the <code class="idl"><a data-link-type="idl" href="#preferencemanager" id="ref-for-preferencemanager①">PreferenceManager</a></code> object.</p>
   <h2 class="heading settled" data-level="3" id="preference-manager"><span class="secno">3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#preferencemanager" id="ref-for-preferencemanager②">PreferenceManager</a></code> interface</span><a class="self-link" href="#preference-manager"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="preferencemanager"><code><c- g>PreferenceManager</c-></code></dfn> {
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-colorschemepref" id="ref-for-enumdef-colorschemepref"><c- n>ColorSchemePref</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="attribute" data-export data-type="ColorSchemePref?" id="dom-preferencemanager-colorscheme"><code><c- g>colorScheme</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-contrastpref" id="ref-for-enumdef-contrastpref"><c- n>ContrastPref</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="attribute" data-export data-type="ContrastPref?" id="dom-preferencemanager-contrast"><code><c- g>contrast</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reducedmotionpref" id="ref-for-enumdef-reducedmotionpref"><c- n>ReducedMotionPref</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="attribute" data-export data-type="ReducedMotionPref?" id="dom-preferencemanager-reducedmotion"><code><c- g>reducedMotion</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reducedtransparencypref" id="ref-for-enumdef-reducedtransparencypref"><c- n>ReducedTransparencyPref</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="attribute" data-export data-type="ReducedTransparencyPref?" id="dom-preferencemanager-reducedtransparency"><code><c- g>reducedTransparency</c-></code></dfn>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reduceddatapref" id="ref-for-enumdef-reduceddatapref"><c- n>ReducedDataPref</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="attribute" data-export data-type="ReducedDataPref?" id="dom-preferencemanager-reduceddata"><code><c- g>reducedData</c-></code></dfn>;

  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#preferencesupportdata" id="ref-for-preferencesupportdata"><c- n>PreferenceSupportData</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-preferencemanager-getsupported" id="ref-for-dom-preferencemanager-getsupported"><c- g>getSupported</c-></a>();
};
</pre>
   <p class="note" role="note"><span class="marker">Note:</span> The exact set of preferences is down to the browser vendor, but it is expected that the set of preferences will be the same as those defined in <a data-link-type="biblio" href="#biblio-mediaqueries-5" title="Media Queries Level 5">[mediaqueries-5]</a>.</p>
   <h3 class="heading settled" data-level="3.1" id="get-supported-method"><span class="secno">3.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-getsupported" id="ref-for-dom-preferencemanager-getsupported①">getSupported</a></code> method</span><a class="self-link" href="#get-supported-method"></a></h3>
   <div class="algorithm" data-algorithm="getSupported()" data-algorithm-for="PreferenceManager">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PreferenceManager" data-dfn-type="method" data-export id="dom-preferencemanager-getsupported"><code>getSupported()</code></dfn> method, when invoked, must run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>supportedPreferences</var> be a new empty sequence.</p>
     <li data-md>
      <p>For each preference that the browser supports, add a new <code class="idl"><a data-link-type="idl" href="#preferencesupportdata" id="ref-for-preferencesupportdata①">PreferenceSupportData</a></code> object to <var>supportedPreferences</var> with the following properties:</p>
      <ul>
       <li data-md>
        <p><code>name</code> set to the name of the preference</p>
       <li data-md>
        <p><code>values</code> set to a sequence of strings representing the valid values for the preference</p>
      </ul>
     <li data-md>
      <p>Return <var>supportedPreferences</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="3.1.1" id="preferencesupportdata-interface"><span class="secno">3.1.1. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#preferencesupportdata" id="ref-for-preferencesupportdata②">PreferenceSupportData</a></code> interface</span><a class="self-link" href="#preferencesupportdata-interface"></a></h4>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="preferencesupportdata"><code><c- g>PreferenceSupportData</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="PreferenceSupportData" data-dfn-type="attribute" data-export data-readonly data-type="DOMString" id="dom-preferencesupportdata-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-preferencesupportdata-name"></a></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a>> <dfn class="idl-code" data-dfn-for="PreferenceSupportData" data-dfn-type="attribute" data-export data-readonly data-type="FrozenArray<DOMString>" id="dom-preferencesupportdata-values"><code><c- g>values</c-></code><a class="self-link" href="#dom-preferencesupportdata-values"></a></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="3.2" id="preference-attributes"><span class="secno">3.2. </span><span class="content">Preference attributes</span><a class="self-link" href="#preference-attributes"></a></h3>
   <h4 class="heading settled" data-level="3.2.1" id="setting-a-preference-attribute"><span class="secno">3.2.1. </span><span class="content">Setting a preference attribute</span><a class="self-link" href="#setting-a-preference-attribute"></a></h4>
   <div class="algorithm" data-algorithm="setting preference override">
     The preference attributes, when set, must run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>preference</var> be the preference attribute’s name.</p>
     <li data-md>
      <p>Let <var>validValues</var> be the preference attribute’s valid values.</p>
     <li data-md>
      <p>If <var>value</var> is not in <var>validValues</var>, return.</p>
     <li data-md>
      <p>If <var>value</var> is the same as the preference override for <var>preference</var>, return.</p>
     <li data-md>
      <p>Set the preference override for <var>preference</var> to <var>value</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-86abb4ed"><a class="self-link" href="#issue-86abb4ed"></a> This algorithm needs more detail on where the overrides are stored. Also need to define what happens when a preference is overridden, with specific regard to sub-resources.</p>
   <h4 class="heading settled" data-level="3.2.2" id="getting-a-preference-attribute"><span class="secno">3.2.2. </span><span class="content">Getting a preference attribute</span><a class="self-link" href="#getting-a-preference-attribute"></a></h4>
   <div class="algorithm" data-algorithm="getting-preference-override">
     The preference attributes, when accessed, must run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>preference</var> be the preference attribute’s name.</p>
     <li data-md>
      <p>If no overrides have been set for the preference, return <code>null</code>.</p>
     <li data-md>
      <p>Let <var>result</var> be the preference override for <var>preference</var>.</p>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <p class="issue" id="issue-482fa236"><a class="self-link" href="#issue-482fa236"></a> This algorithm needs more detail on where the overrides are stored.</p>
   <h4 class="heading settled" data-level="3.2.3" id="colorscheme-preference"><span class="secno">3.2.3. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-colorscheme" id="ref-for-dom-preferencemanager-colorscheme">colorScheme</a></code> preference</span><a class="self-link" href="#colorscheme-preference"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-colorscheme" id="ref-for-dom-preferencemanager-colorscheme①">colorScheme</a></code> preference represents the user’s preference for the color scheme of the site.
This is modeled after the <code>prefers-color-scheme</code> user preference media feature as defined in <a href="https://drafts.csswg.org/mediaqueries-5/#prefers-color-scheme"><cite>Media Queries 5</cite> § 11.5 Detecting the desire for light or dark color schemes: the prefers-color-scheme feature</a>.</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-colorschemepref"><code><c- g>ColorSchemePref</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="ColorSchemePref" data-dfn-type="enum-value" data-export id="dom-colorschemepref-light"><code><c- s>"light"</c-></code><a class="self-link" href="#dom-colorschemepref-light"></a></dfn>, <dfn class="idl-code" data-dfn-for="ColorSchemePref" data-dfn-type="enum-value" data-export id="dom-colorschemepref-dark"><code><c- s>"dark"</c-></code><a class="self-link" href="#dom-colorschemepref-dark"></a></dfn> };
</pre>
   <h4 class="heading settled" data-level="3.2.4" id="contrast-preference"><span class="secno">3.2.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-contrast" id="ref-for-dom-preferencemanager-contrast">contrast</a></code> preference</span><a class="self-link" href="#contrast-preference"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-contrast" id="ref-for-dom-preferencemanager-contrast①">contrast</a></code> preference represents the user’s preference for the contrast of the site.
This is modeled after the <code>prefers-contrast</code> user preference media feature as defined in <a href="https://drafts.csswg.org/mediaqueries-5/#prefers-contrast"><cite>Media Queries 5</cite> § 11.3 Detecting the desire for increased or decreased color contrast from elements on the page: the prefers-contrast feature</a>.</p>
   <p>Unlike the media feature this preference is not able to be set to <code>custom</code> this is tightly coupled to the <code>forced-colors</code> media feature.</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-contrastpref"><code><c- g>ContrastPref</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="ContrastPref" data-dfn-type="enum-value" data-export id="dom-contrastpref-no-preference"><code><c- s>"no-preference"</c-></code><a class="self-link" href="#dom-contrastpref-no-preference"></a></dfn>, <dfn class="idl-code" data-dfn-for="ContrastPref" data-dfn-type="enum-value" data-export id="dom-contrastpref-more"><code><c- s>"more"</c-></code><a class="self-link" href="#dom-contrastpref-more"></a></dfn>, <dfn class="idl-code" data-dfn-for="ContrastPref" data-dfn-type="enum-value" data-export id="dom-contrastpref-less"><code><c- s>"less"</c-></code><a class="self-link" href="#dom-contrastpref-less"></a></dfn> };
</pre>
   <h4 class="heading settled" data-level="3.2.5" id="reducedmotion-preference"><span class="secno">3.2.5. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reducedmotion" id="ref-for-dom-preferencemanager-reducedmotion">reducedMotion</a></code> preference</span><a class="self-link" href="#reducedmotion-preference"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reducedmotion" id="ref-for-dom-preferencemanager-reducedmotion①">reducedMotion</a></code> preference represents the user’s preference for reduced motion on the site.
This is modeled after the <code>prefers-reduced-motion</code> user preference media feature as defined in <a href="https://drafts.csswg.org/mediaqueries-5/#prefers-reduced-motion"><cite>Media Queries 5</cite> § 11.1 Detecting the desire for less motion on the page: the prefers-reduced-motion feature</a>.</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-reducedmotionpref"><code><c- g>ReducedMotionPref</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="ReducedMotionPref" data-dfn-type="enum-value" data-export id="dom-reducedmotionpref-no-preference"><code><c- s>"no-preference"</c-></code><a class="self-link" href="#dom-reducedmotionpref-no-preference"></a></dfn>, <dfn class="idl-code" data-dfn-for="ReducedMotionPref" data-dfn-type="enum-value" data-export id="dom-reducedmotionpref-reduce"><code><c- s>"reduce"</c-></code><a class="self-link" href="#dom-reducedmotionpref-reduce"></a></dfn> };
</pre>
   <h4 class="heading settled" data-level="3.2.6" id="reducedtransparency-preference"><span class="secno">3.2.6. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reducedtransparency" id="ref-for-dom-preferencemanager-reducedtransparency">reducedTransparency</a></code> preference</span><a class="self-link" href="#reducedtransparency-preference"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reducedtransparency" id="ref-for-dom-preferencemanager-reducedtransparency①">reducedTransparency</a></code> preference represents the user’s preference for reduced transparency on the site.
This is modeled after the <code>prefers-reduced-transparency</code> user preference media feature as defined in <a href="https://drafts.csswg.org/mediaqueries-5/#prefers-reduced-transparency"><cite>Media Queries 5</cite> § 11.2 Detecting the desire for reduced transparency on the page: the prefers-reduced-transparency feature</a>.</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-reducedtransparencypref"><code><c- g>ReducedTransparencyPref</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="ReducedTransparencyPref" data-dfn-type="enum-value" data-export id="dom-reducedtransparencypref-no-preference"><code><c- s>"no-preference"</c-></code><a class="self-link" href="#dom-reducedtransparencypref-no-preference"></a></dfn>, <dfn class="idl-code" data-dfn-for="ReducedTransparencyPref" data-dfn-type="enum-value" data-export id="dom-reducedtransparencypref-reduce"><code><c- s>"reduce"</c-></code><a class="self-link" href="#dom-reducedtransparencypref-reduce"></a></dfn> };
</pre>
   <h4 class="heading settled" data-level="3.2.7" id="reduceddata-preference"><span class="secno">3.2.7. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reduceddata" id="ref-for-dom-preferencemanager-reduceddata">reducedData</a></code> preference</span><a class="self-link" href="#reduceddata-preference"></a></h4>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-preferencemanager-reduceddata" id="ref-for-dom-preferencemanager-reduceddata①">reducedData</a></code> preference represents the user’s preference for reduced data usage on the site.
This is modeled after the <code>prefers-reduced-data</code> user preference media feature as defined in <a href="https://drafts.csswg.org/mediaqueries-5/#prefers-reduced-data"><cite>Media Queries 5</cite> § 11.6 Detecting the desire for reduced data usage when loading a page: the prefers-reduced-data feature</a>.</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-reduceddatapref"><code><c- g>ReducedDataPref</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="ReducedDataPref" data-dfn-type="enum-value" data-export id="dom-reduceddatapref-no-preference"><code><c- s>"no-preference"</c-></code><a class="self-link" href="#dom-reduceddatapref-no-preference"></a></dfn>, <dfn class="idl-code" data-dfn-for="ReducedDataPref" data-dfn-type="enum-value" data-export id="dom-reduceddatapref-reduce"><code><c- s>"reduce"</c-></code><a class="self-link" href="#dom-reduceddatapref-reduce"></a></dfn> };
</pre>
   <h2 class="heading settled" data-level="4" id="usage-examples"><span class="secno">4. </span><span class="content">Usage Examples</span><a class="self-link" href="#usage-examples"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>Each preference the browser supports will be exposed as a property on the <code>navigator.preferences</code> object.</p>
   <p>Feature detection for a given preference is as simple as:</p>
<pre class="language-js highlight"><c- a>const</c-> colorSchemeSupported <c- o>=</c-> <c- t>'colorScheme'</c-> <c- ow>in</c-> navigator<c- p>.</c->preferences<c- p>;</c->
</pre>
   <h3 class="heading settled" data-level="4.1" id="setting-a-preference-override"><span class="secno">4.1. </span><span class="content">Setting a preference override</span><a class="self-link" href="#setting-a-preference-override"></a></h3>
   <p>To set a preference override, the property can be set to a valid value for the preference.
If an invalid value is set then this will be a no-op.</p>
<pre class="language-js highlight">navigator<c- p>.</c->preferences<c- p>.</c->colorScheme <c- o>=</c-> <c- t>'dark'</c-><c- p>;</c->
</pre>
   <h3 class="heading settled" data-level="4.2" id="clearing-overrides"><span class="secno">4.2. </span><span class="content">Clearing a preference override</span><a class="self-link" href="#clearing-overrides"></a></h3>
   <p>To clear an override and return the preference to the browser default, the property can be set to null.</p>
<pre class="language-js highlight">navigator<c- p>.</c->preferences<c- p>.</c->colorScheme <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
</pre>
   <h3 class="heading settled" data-level="4.3" id="getting-a-preference-override"><span class="secno">4.3. </span><span class="content">Getting a preference override</span><a class="self-link" href="#getting-a-preference-override"></a></h3>
   <p>To get the value of a preference override, the property can be read.
Each property will return the string value indicating the preference, or null if no override is set.</p>
<pre class="language-js highlight"><c- a>const</c-> colorScheme <c- o>=</c-> navigator<c- p>.</c->preferences<c- p>.</c->colorScheme<c- p>;</c-> <c- c1>// "light" | "dark" | null</c->
</pre>
   <h3 class="heading settled" data-level="4.4" id="get-supported"><span class="secno">4.4. </span><span class="content">The <code>navigator.preferences.getSupported</code> method</span><a class="self-link" href="#get-supported"></a></h3>
   <p>This method allows a site to get the preferences supported by the browser. This is useful for sites that want to dynamically generate UI for overriding preferences.</p>
   <p>It also allows sites to determine if a preference value is supported before attempting to set it.</p>
<pre class="language-js highlight"><c- a>const</c-> preferenceSupportData <c- o>=</c-> navigator<c- p>.</c->preferences<c- p>.</c->getSupported<c- p>();</c->
console<c- p>.</c->log<c- p>(</c->preferenceSupportData<c- p>);</c-> <c- c1>// [ { name: 'contrast', values: ['more', 'less', 'no-preference'] }, ... ]</c->
</pre>
   <h2 class="heading settled" data-level="5" id="sec-security"><span class="secno">5. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#sec-security"></a></h2>
   <p class="issue" id="issue-49e7f9d0"><a class="self-link" href="#issue-49e7f9d0"></a> The API is currently exposed even to insecure contexts. This is probably fine but should be justified in this section probably?</p>
   <p><em>This section is non-normative.</em></p>
   <h3 class="heading settled" data-level="5.1" id="fingerprinting"><span class="secno">5.1. </span><span class="content">Avoiding fingerprinting</span><a class="self-link" href="#fingerprinting"></a></h3>
   <p>This API exposes no new fingerprinting surfaces beyond that which already exist in the platform.</p>
   <h3 class="heading settled" data-level="5.2" id="permissions"><span class="secno">5.2. </span><span class="content">Permissions &amp; User Activation</span><a class="self-link" href="#permissions"></a></h3>
   <p>This API does not require any permissions or user activation. It exposes no new capabilities to a site beyond that which already exists in the platform.</p>
   <p>A site can already store a value in local storage and read into the DOM to override a preference. This API simply makes the ergonomics of this better.</p>
   <h3 class="heading settled" data-level="5.3" id="sub-resources"><span class="secno">5.3. </span><span class="content">Sub-resources</span><a class="self-link" href="#sub-resources"></a></h3>
   <p class="note" role="note"><span class="marker">Note:</span> See <a href="https://github.com/lukewarlow/web-preferences-api/issues/8">#8</a> for discussion regarding this.</p>
   <p>For the spec we can probably find an existing definition to reference, but for the purposes of this explainer:</p>
   <ul>
    <li data-md>
     <p>Any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> subresource (e.g. iframes) should get the overridden value.</p>
    <li data-md>
     <p>Any cross-origin subresource that already has communication with the parent (e.g. <code>postMessage</code>) should get the override value.</p>
    <li data-md>
     <p>Any cross-origin subresource with no external communication (e.g. an SVG loaded as an image) should get the override value.</p>
    <li data-md>
     <p>Any cross-origin subresource that has no communication with parent but can communicate externally should <strong>NOT</strong> get the override value.</p>
   </ul>
   <p>Wherever the override value is passed down it should be done so in an opaque manner.</p>
   <div class="example" id="example-c7663e92"><a class="self-link" href="#example-c7663e92"></a> If the parent frame sets <code>colorScheme</code> to <code>dark</code> then the iframe should see <code>prefers-color-scheme</code> as dark but shouldn’t read <code>navigator.preferences.colorScheme</code> as <code>dark</code>. </div>
   <h2 class="heading settled" data-level="6" id="sec-acknowledgements"><span class="secno">6. </span><span class="content">Acknowledgements</span><a class="self-link" href="#sec-acknowledgements"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p class="issue" id="issue-bfd5fd46"><a class="self-link" href="#issue-bfd5fd46"></a> TODO fill in acknowledgements section</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-preferencemanager-colorscheme">colorScheme</a><span>, in § 3</span>
   <li><a href="#enumdef-colorschemepref">ColorSchemePref</a><span>, in § 3.2.3</span>
   <li><a href="#dom-preferencemanager-contrast">contrast</a><span>, in § 3</span>
   <li><a href="#enumdef-contrastpref">ContrastPref</a><span>, in § 3.2.4</span>
   <li><a href="#dom-colorschemepref-dark">"dark"</a><span>, in § 3.2.3</span>
   <li><a href="#dom-preferencemanager-getsupported">getSupported()</a><span>, in § 3.1</span>
   <li><a href="#dom-contrastpref-less">"less"</a><span>, in § 3.2.4</span>
   <li><a href="#dom-colorschemepref-light">"light"</a><span>, in § 3.2.3</span>
   <li><a href="#dom-contrastpref-more">"more"</a><span>, in § 3.2.4</span>
   <li><a href="#dom-preferencesupportdata-name">name</a><span>, in § 3.1.1</span>
   <li>
    "no-preference"
    <ul>
     <li><a href="#dom-contrastpref-no-preference">enum-value for ContrastPref</a><span>, in § 3.2.4</span>
     <li><a href="#dom-reduceddatapref-no-preference">enum-value for ReducedDataPref</a><span>, in § 3.2.7</span>
     <li><a href="#dom-reducedmotionpref-no-preference">enum-value for ReducedMotionPref</a><span>, in § 3.2.5</span>
     <li><a href="#dom-reducedtransparencypref-no-preference">enum-value for ReducedTransparencyPref</a><span>, in § 3.2.6</span>
    </ul>
   <li><a href="#preferencemanager">PreferenceManager</a><span>, in § 3</span>
   <li><a href="#dom-navigator-preferences">preferences</a><span>, in § 2</span>
   <li><a href="#preferencesupportdata">PreferenceSupportData</a><span>, in § 3.1.1</span>
   <li>
    "reduce"
    <ul>
     <li><a href="#dom-reduceddatapref-reduce">enum-value for ReducedDataPref</a><span>, in § 3.2.7</span>
     <li><a href="#dom-reducedmotionpref-reduce">enum-value for ReducedMotionPref</a><span>, in § 3.2.5</span>
     <li><a href="#dom-reducedtransparencypref-reduce">enum-value for ReducedTransparencyPref</a><span>, in § 3.2.6</span>
    </ul>
   <li><a href="#dom-preferencemanager-reduceddata">reducedData</a><span>, in § 3</span>
   <li><a href="#enumdef-reduceddatapref">ReducedDataPref</a><span>, in § 3.2.7</span>
   <li><a href="#dom-preferencemanager-reducedmotion">reducedMotion</a><span>, in § 3</span>
   <li><a href="#enumdef-reducedmotionpref">ReducedMotionPref</a><span>, in § 3.2.5</span>
   <li><a href="#dom-preferencemanager-reducedtransparency">reducedTransparency</a><span>, in § 3</span>
   <li><a href="#enumdef-reducedtransparencypref">ReducedTransparencyPref</a><span>, in § 3.2.6</span>
   <li><a href="#dom-preferencesupportdata-values">values</a><span>, in § 3.1.1</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="be0c27b2">Navigator</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="dcf5fafa">FrozenArray</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-color-adjust-1">[CSS-COLOR-ADJUST-1]
   <dd>Elika Etemad; et al. <a href="https://drafts.csswg.org/css-color-adjust-1/"><cite>CSS Color Adjustment Module Level 1</cite></a>. URL: <a href="https://drafts.csswg.org/css-color-adjust-1/">https://drafts.csswg.org/css-color-adjust-1/</a>
   <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
   <dd>Simon Pieters. <a href="https://drafts.csswg.org/cssom-view/"><cite>CSSOM View Module</cite></a>. URL: <a href="https://drafts.csswg.org/cssom-view/">https://drafts.csswg.org/cssom-view/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-mediaqueries-5">[MEDIAQUERIES-5]
   <dd>Dean Jackson; et al. <a href="https://drafts.csswg.org/mediaqueries-5/"><cite>Media Queries Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/mediaqueries-5/">https://drafts.csswg.org/mediaqueries-5/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-user-preference-media-features-headers">[USER-PREFERENCE-MEDIA-FEATURES-HEADERS]
   <dd><a href="https://wicg.github.io/user-preference-media-features-headers/"><cite>User Preference Media Features Client Hints Headers</cite></a>. Draft Community Group Report. URL: <a href="https://wicg.github.io/user-preference-media-features-headers/">https://wicg.github.io/user-preference-media-features-headers/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/system-state.html#navigator"><c- g>Navigator</c-></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#preferencemanager"><c- n>PreferenceManager</c-></a> <a data-readonly data-type="PreferenceManager" href="#dom-navigator-preferences"><code><c- g>preferences</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#preferencemanager"><code><c- g>PreferenceManager</c-></code></a> {
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-colorschemepref"><c- n>ColorSchemePref</c-></a>? <a data-type="ColorSchemePref?" href="#dom-preferencemanager-colorscheme"><code><c- g>colorScheme</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-contrastpref"><c- n>ContrastPref</c-></a>? <a data-type="ContrastPref?" href="#dom-preferencemanager-contrast"><code><c- g>contrast</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reducedmotionpref"><c- n>ReducedMotionPref</c-></a>? <a data-type="ReducedMotionPref?" href="#dom-preferencemanager-reducedmotion"><code><c- g>reducedMotion</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reducedtransparencypref"><c- n>ReducedTransparencyPref</c-></a>? <a data-type="ReducedTransparencyPref?" href="#dom-preferencemanager-reducedtransparency"><code><c- g>reducedTransparency</c-></code></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-reduceddatapref"><c- n>ReducedDataPref</c-></a>? <a data-type="ReducedDataPref?" href="#dom-preferencemanager-reduceddata"><code><c- g>reducedData</c-></code></a>;

  <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="#preferencesupportdata"><c- n>PreferenceSupportData</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-preferencemanager-getsupported"><c- g>getSupported</c-></a>();
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#preferencesupportdata"><code><c- g>PreferenceSupportData</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a data-readonly data-type="DOMString" href="#dom-preferencesupportdata-name"><code><c- g>name</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a data-readonly data-type="FrozenArray<DOMString>" href="#dom-preferencesupportdata-values"><code><c- g>values</c-></code></a>;
};

<c- b>enum</c-> <a href="#enumdef-colorschemepref"><code><c- g>ColorSchemePref</c-></code></a> { <a href="#dom-colorschemepref-light"><code><c- s>"light"</c-></code></a>, <a href="#dom-colorschemepref-dark"><code><c- s>"dark"</c-></code></a> };

<c- b>enum</c-> <a href="#enumdef-contrastpref"><code><c- g>ContrastPref</c-></code></a> { <a href="#dom-contrastpref-no-preference"><code><c- s>"no-preference"</c-></code></a>, <a href="#dom-contrastpref-more"><code><c- s>"more"</c-></code></a>, <a href="#dom-contrastpref-less"><code><c- s>"less"</c-></code></a> };

<c- b>enum</c-> <a href="#enumdef-reducedmotionpref"><code><c- g>ReducedMotionPref</c-></code></a> { <a href="#dom-reducedmotionpref-no-preference"><code><c- s>"no-preference"</c-></code></a>, <a href="#dom-reducedmotionpref-reduce"><code><c- s>"reduce"</c-></code></a> };

<c- b>enum</c-> <a href="#enumdef-reducedtransparencypref"><code><c- g>ReducedTransparencyPref</c-></code></a> { <a href="#dom-reducedtransparencypref-no-preference"><code><c- s>"no-preference"</c-></code></a>, <a href="#dom-reducedtransparencypref-reduce"><code><c- s>"reduce"</c-></code></a> };

<c- b>enum</c-> <a href="#enumdef-reduceddatapref"><code><c- g>ReducedDataPref</c-></code></a> { <a href="#dom-reduceddatapref-no-preference"><code><c- s>"no-preference"</c-></code></a>, <a href="#dom-reduceddatapref-reduce"><code><c- s>"reduce"</c-></code></a> };

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> This spec requires large amounts of work to section it and word it in ways that are normative. It is currently a very rough draft. <a class="issue-return" href="#issue-04eeaa1b" title="Jump to section">↵</a></div>
   <div class="issue">
     Unsure how to link to html spec for the 
    <source media>
     example. <a class="issue-return" href="#issue-1b6e079b" title="Jump to section">↵</a>
   </div>
   <div class="issue"> This algorithm needs more detail on where the overrides are stored. Also need to define what happens when a preference is overridden, with specific regard to sub-resources. <a class="issue-return" href="#issue-86abb4ed" title="Jump to section">↵</a></div>
   <div class="issue"> This algorithm needs more detail on where the overrides are stored. <a class="issue-return" href="#issue-482fa236" title="Jump to section">↵</a></div>
   <div class="issue"> The API is currently exposed even to insecure contexts. This is probably fine but should be justified in this section probably? <a class="issue-return" href="#issue-49e7f9d0" title="Jump to section">↵</a></div>
   <div class="issue"> TODO fill in acknowledgements section <a class="issue-return" href="#issue-bfd5fd46" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['be0c27b2'] = {"dfnID": "be0c27b2", "url": "https://html.spec.whatwg.org/multipage/system-state.html#navigator", "dfnText": "Navigator", "refSections": [{"refs": [{"id": "ref-for-navigator"}, {"id": "ref-for-navigator\u2460"}], "title": "2. Extensions to the Navigator interface"}], "external": true};
window.dfnpanelData['086e3aff'] = {"dfnID": "086e3aff", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin"}], "title": "1. Introduction"}], "external": true};
window.dfnpanelData['7393da89'] = {"dfnID": "7393da89", "url": "https://html.spec.whatwg.org/multipage/browsers.html#same-origin", "dfnText": "same origin", "refSections": [{"refs": [{"id": "ref-for-same-origin"}], "title": "5.3. Sub-resources"}], "external": true};
window.dfnpanelData['8855a9aa'] = {"dfnID": "8855a9aa", "url": "https://webidl.spec.whatwg.org/#idl-DOMString", "dfnText": "DOMString", "refSections": [{"refs": [{"id": "ref-for-idl-DOMString"}, {"id": "ref-for-idl-DOMString\u2460"}], "title": "3.1.1. PreferenceSupportData interface"}], "external": true};
window.dfnpanelData['889e932f'] = {"dfnID": "889e932f", "url": "https://webidl.spec.whatwg.org/#Exposed", "dfnText": "Exposed", "refSections": [{"refs": [{"id": "ref-for-Exposed"}], "title": "2. Extensions to the Navigator interface"}, {"refs": [{"id": "ref-for-Exposed\u2460"}], "title": "3. PreferenceManager interface"}, {"refs": [{"id": "ref-for-Exposed\u2461"}], "title": "3.1.1. PreferenceSupportData interface"}], "external": true};
window.dfnpanelData['dcf5fafa'] = {"dfnID": "dcf5fafa", "url": "https://webidl.spec.whatwg.org/#idl-frozen-array", "dfnText": "FrozenArray", "refSections": [{"refs": [{"id": "ref-for-idl-frozen-array"}], "title": "3.1.1. PreferenceSupportData interface"}], "external": true};
window.dfnpanelData['9cce47fd'] = {"dfnID": "9cce47fd", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "dfnText": "sequence", "refSections": [{"refs": [{"id": "ref-for-idl-sequence"}], "title": "3. PreferenceManager interface"}], "external": true};
window.dfnpanelData['dom-navigator-preferences'] = {"dfnID": "dom-navigator-preferences", "url": "#dom-navigator-preferences", "dfnText": "preferences", "refSections": [{"refs": [{"id": "ref-for-dom-navigator-preferences"}, {"id": "ref-for-dom-navigator-preferences\u2460"}], "title": "2.1. preferences attribute"}], "external": false};
window.dfnpanelData['preferencemanager'] = {"dfnID": "preferencemanager", "url": "#preferencemanager", "dfnText": "PreferenceManager", "refSections": [{"refs": [{"id": "ref-for-preferencemanager"}], "title": "2. Extensions to the Navigator interface"}, {"refs": [{"id": "ref-for-preferencemanager\u2460"}], "title": "2.1. preferences attribute"}, {"refs": [{"id": "ref-for-preferencemanager\u2461"}], "title": "3. PreferenceManager interface"}], "external": false};
window.dfnpanelData['dom-preferencemanager-colorscheme'] = {"dfnID": "dom-preferencemanager-colorscheme", "url": "#dom-preferencemanager-colorscheme", "dfnText": "colorScheme", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-colorscheme"}, {"id": "ref-for-dom-preferencemanager-colorscheme\u2460"}], "title": "3.2.3. colorScheme preference"}], "external": false};
window.dfnpanelData['dom-preferencemanager-contrast'] = {"dfnID": "dom-preferencemanager-contrast", "url": "#dom-preferencemanager-contrast", "dfnText": "contrast", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-contrast"}, {"id": "ref-for-dom-preferencemanager-contrast\u2460"}], "title": "3.2.4. contrast preference"}], "external": false};
window.dfnpanelData['dom-preferencemanager-reducedmotion'] = {"dfnID": "dom-preferencemanager-reducedmotion", "url": "#dom-preferencemanager-reducedmotion", "dfnText": "reducedMotion", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-reducedmotion"}, {"id": "ref-for-dom-preferencemanager-reducedmotion\u2460"}], "title": "3.2.5. reducedMotion preference"}], "external": false};
window.dfnpanelData['dom-preferencemanager-reducedtransparency'] = {"dfnID": "dom-preferencemanager-reducedtransparency", "url": "#dom-preferencemanager-reducedtransparency", "dfnText": "reducedTransparency", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-reducedtransparency"}, {"id": "ref-for-dom-preferencemanager-reducedtransparency\u2460"}], "title": "3.2.6. reducedTransparency preference"}], "external": false};
window.dfnpanelData['dom-preferencemanager-reduceddata'] = {"dfnID": "dom-preferencemanager-reduceddata", "url": "#dom-preferencemanager-reduceddata", "dfnText": "reducedData", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-reduceddata"}, {"id": "ref-for-dom-preferencemanager-reduceddata\u2460"}], "title": "3.2.7. reducedData preference"}], "external": false};
window.dfnpanelData['dom-preferencemanager-getsupported'] = {"dfnID": "dom-preferencemanager-getsupported", "url": "#dom-preferencemanager-getsupported", "dfnText": "getSupported()", "refSections": [{"refs": [{"id": "ref-for-dom-preferencemanager-getsupported"}], "title": "3. PreferenceManager interface"}, {"refs": [{"id": "ref-for-dom-preferencemanager-getsupported\u2460"}], "title": "3.1. getSupported method"}], "external": false};
window.dfnpanelData['preferencesupportdata'] = {"dfnID": "preferencesupportdata", "url": "#preferencesupportdata", "dfnText": "PreferenceSupportData", "refSections": [{"refs": [{"id": "ref-for-preferencesupportdata"}], "title": "3. PreferenceManager interface"}, {"refs": [{"id": "ref-for-preferencesupportdata\u2460"}], "title": "3.1. getSupported method"}, {"refs": [{"id": "ref-for-preferencesupportdata\u2461"}], "title": "3.1.1. PreferenceSupportData interface"}], "external": false};
window.dfnpanelData['enumdef-colorschemepref'] = {"dfnID": "enumdef-colorschemepref", "url": "#enumdef-colorschemepref", "dfnText": "ColorSchemePref", "refSections": [{"refs": [{"id": "ref-for-enumdef-colorschemepref"}], "title": "3. PreferenceManager interface"}], "external": false};
window.dfnpanelData['enumdef-contrastpref'] = {"dfnID": "enumdef-contrastpref", "url": "#enumdef-contrastpref", "dfnText": "ContrastPref", "refSections": [{"refs": [{"id": "ref-for-enumdef-contrastpref"}], "title": "3. PreferenceManager interface"}], "external": false};
window.dfnpanelData['enumdef-reducedmotionpref'] = {"dfnID": "enumdef-reducedmotionpref", "url": "#enumdef-reducedmotionpref", "dfnText": "ReducedMotionPref", "refSections": [{"refs": [{"id": "ref-for-enumdef-reducedmotionpref"}], "title": "3. PreferenceManager interface"}], "external": false};
window.dfnpanelData['enumdef-reducedtransparencypref'] = {"dfnID": "enumdef-reducedtransparencypref", "url": "#enumdef-reducedtransparencypref", "dfnText": "ReducedTransparencyPref", "refSections": [{"refs": [{"id": "ref-for-enumdef-reducedtransparencypref"}], "title": "3. PreferenceManager interface"}], "external": false};
window.dfnpanelData['enumdef-reduceddatapref'] = {"dfnID": "enumdef-reduceddatapref", "url": "#enumdef-reduceddatapref", "dfnText": "ReducedDataPref", "refSections": [{"refs": [{"id": "ref-for-enumdef-reduceddatapref"}], "title": "3. PreferenceManager interface"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>